<odoo>
  <data>

    <!-- filtros para las anulaciones  -->
    <record model="ir.ui.view" id="maya_students.cancellation_tree_search">
      <field name="name">Agrupacion para tareas</field>
      <field name="model">maya_students.cancellation</field>
      <field name="arch" type="xml">
        <search>
          <group expand='0' string='Agrupar'>
            <filter name="group_by_course" string="Por ciclo" context="{'group_by': 'subject_course'}"/>
            <filter name="group_by_subject" string="Por módulo" context="{'group_by': 'subject_name'}"/>
          </group>
        </search>    
      </field>
    </record>

    <record model="ir.ui.view" id="maya_students.cancellation_tree">
      <field name="name">Lista de anulaciones</field>
      <field name="model">maya_students.cancellation</field>
      <field name="arch" type="xml">
        <tree limit="20">
          <field name="student_name" />
          <field name="subject_name" />
          <field name="subject_course" />
          <field name="situation" />
        </tree>
      </field>
    </record>

    <record model="ir.ui.view" id="maya_students.cancellation_form">
      <field name="name">cancellation.form.view</field>
      <field name="model">maya_students.cancellation</field>
      <field name="arch" type="xml">
        <form>
          <group col='3'>
            <group>
              <field name="student_name" />
              <field name="student_nia" /> 
            </group>
            <group>
              <field name="student_email" />
              <field name="student_email_support" /> 
              <field name="student_email_corp" /> 
            </group>
            <group>
              <field name="subject_name" /> 
              <field name="subject_course" />
              <field name="situation" widget="badge"
                    decoration-warning="situation in ['4', '5']"
                    decoration-danger="situation in ['7', '8']"
                    decoration-success="situation == '6'"
                    decoration-primary="situation in ['1', '8']"
                    />
              <button name="send_notification_mail_subject"
                      type="object"
                      string="Forzar envio mail"
                      icon="fa-envelope"
                      class="btn-secondary text-nowrap"/>
            </group>
          </group>
          <separator string="Información" style="padding-bottom:15px"/>
          <group col="2">
            <group>
              <field name="lastaccess_date_text" readonly="1"/> 
              <field name="classroom_moodle_id" readonly="1"/> 
            </group>
            <group>
              <field name="query_date" readonly="1"/> 
              <field name="classroom_link" widget="url" readonly="1"/>
            </group>
          </group>
          <notebook>
            <page string='Justificación'>
              <group col="2">
                <group>
                  <field name="justification_end_date" />
                </group>
                <group>
                  <div class="d-flex gap-4">
                    <button name="set_justification_to_june"
                                    type="object"
                                    icon="fa-calendar-check-o"
                                    string="Justificar hasta final de curso"
                                    class="btn-secondary text-nowrap"/>
                    <button name="clear_justification_date"
                                  type="object"
                                  string="Borrar justificación"
                                  icon="fa-trash"
                                  class="btn-secondary text-nowrap"
                                  style="width: 100%"
                                  invisible="justification_end_date==False"/>
                  </div>
                </group>
              </group>
              <group>
                <field name="comments" />
              </group>
            </page>            
            <page string='Notificaciones'>
              <group>
                <field name="notification_date" readonly="1"/>
              </group>
            </page>
            <page string='Otras anulaciones'>
              <field name="related_cancellations_ids" readonly="1">
                <tree>
                  <field name="subject_name"/>
                  <field name="subject_course"/>
                  <field name="situation"/>
                  <field name="justification_end_date"/>
                </tree>
              </field>
            </page>
            <page string='Profesorado'>
              <field name="teacher_employee_ids" readonly="1">
                <tree>
                  <field name="surname"/>
                  <field name="name"/>
                  <field name="work_email"/>
                </tree>
              </field>
            </page>
          </notebook>
        </form>
      
      </field>
    </record>

    <!-- actions opening views on models -->
    <record model="ir.actions.act_window" id="maya_students.action_cancellation_ordinary">
      <field name="name">Anulaciones ordinarias</field>
      <field name="res_model">maya_students.cancellation</field>
      <field name="view_mode">tree</field> 
      <field name="domain">[('cancellation_type', '=', 'ORD')]</field>
      <field name="help" type="html">
        <p class="o_view_nocontent_smiling_face">Todavía no hay ninguna anulación de matrícula pendiente</p>
      </field>
    </record>

    <record model="ir.actions.act_window" id="maya_students.action_cancellation_exofficio">
      <field name="name">Anulaciones de oficio</field>
      <field name="res_model">maya_students.cancellation</field>
      <field name="view_mode">tree,form</field>
      <field name="domain">[('cancellation_type', '=', 'OFC')]</field>
      <field name="context">{
        'search_default_group_by_course': 1,
        'search_default_group_by_subject': 1,
      }
      </field>
      
      <field name="help" type="html">
        <p class="o_view_nocontent_smiling_face">Todavía no hay ninguna baja de oficio pendiente</p>
      </field>
    </record>

    <record model="ir.actions.act_window" id="maya_students.action_config_settings">
      <field name="name">Configuración</field>
      <field name="res_model">res.config.settings</field>
      <field name="view_mode">form</field>
      <field name="target">inline</field> <!-- new window: emergente, curret: en al misma, inline: sin botones editar/crear-->
      <field name="context">{'module': 'maya_students'}</field>
    </record>

    <!-- Top menu item -->
    <menuitem name="Maya | Estudiantes" id="maya_students.menu_root" sequence="4"/>

    <!-- menu categories -->
    <menuitem name="Anulaciones" id="maya_students.menu_cancellation" parent="maya_students.menu_root"/>
    <menuitem name="Configuración" id="maya_students.menu_configuration" parent="maya_students.menu_root"/>
    
    <!-- menú convalidaciones -->
    <menuitem name="Ordinarias" id="maya_students.menu_cancellation_ordinary" parent="maya_students.menu_cancellation"
              action="maya_students.action_cancellation_ordinary"/>
    <menuitem name="Oficio" id="maya_students.menu_cancellation_exofficio" parent="maya_students.menu_cancellation"
              action="maya_students.action_cancellation_exofficio"/>
  
    <!-- Menu Configuración -->
    <menuitem name="General" id="maya_students.menu_settings" parent="maya_students.menu_configuration"
              action="maya_students.action_config_settings"/>
  </data>
</odoo>